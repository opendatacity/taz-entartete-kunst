function PageNav(e,t){function n(e,t){var n=$("<li>");if(n.html('<span class="page-number">'+e+"</span>"),!a){var r=$("<img>"),o=$("<a>");r.attr({src:H.imgSrc(e,!0),alt:""+e}),o.attr("href","#reader-"+e),o.data("index",t),o.append(r),n.append(o)}return l.push(n),n}var r,a,o,i=$(e),s=$('<ul class="pages">'),c=$(window),l=[],u=0;i.append(s),t.reader&&(o=t.reader,s.on("click","a",function(e){e.preventDefault(),e.stopImmediatePropagation();var n=$(this).data("index");t.readerNav||o.show(r),window.setTimeout(function(){o.goTo(n)},1)}),$(t.reader).on("reader:pagechange",function(e,t){try{l[u].removeClass("active");var n=l[t];n.addClass("active");var r=n.position().top,a=n.height();if(r+a>c.height()){var o=s.parent(),i=o.scrollTop();o.scrollTop(i+r-c.height()+a)}else if(0>r){var o=s.parent();o.scrollTop(o.scrollTop()+r)}}catch(d){}u=t})),this.update=function(e,t){i.addClass("result"),r=e,a=!!t,$("h2").text(e[0]),this.clear(),e[1].forEach(function(e,t){s.append(n(e,t))})},this.clear=function(){i.addClass("empty"),s.empty(),l=[],u=0}}function Reader(e){function t(){$overlay.removeClass("hidden"),c.addClass("blur"),d=!0}function n(){$overlay.addClass("hidden"),c.removeClass("blur"),d=!1}function r(){for(var e=0,t=null,n=h.length;n>e;e++){var r=h[e],a=r.find(".lazy"),o=r.position().top,s=r.height(),c=o+s,l=$(window).height()-o,d=o+s/2;c>-200&&l>-200&&(a.attr("src",a.attr("data-highres")),a.removeClass("lazy")),d>=0&&null===t&&(t=e)}t!==i&&(i=t,u.trigger("reader:pagechange",i))}function a(e){var t=$("<p>"),n=$("<img>");return n.addClass("lazy"),n.attr("src",H.imgSrc(e,!0)),n.attr("data-highres",H.imgSrc(e)),n.attr({width:800,height:1067}),t.append(n),t.attr("id","reader-"+e),t.addClass(".page"),h.push(t),t}var o,i,s=$(e),c=$(document.body),l=this,u=$(this),d=!1,h=[];s.wrap($('<div class="reader-overlay">')),$overlay=s.parent();var f=s.children();$overlay.append(f);var p=$("<nav>");$overlay.append(p);var v=new PageNav(p,{reader:this,readerNav:!0}),g=$("<button>×</button>");g.addClass("btn btn-close"),$overlay.append(g);var m=$("<h2>");$overlay.append(m),g.click(n);var y={27:function(){g.trigger("click")},37:function(){return l.previousPage(),!1},39:function(){return l.nextPage(),!1},38:function(){return l.scrollBy(-70),!1},40:function(){return l.scrollBy(70),!1}};c.keydown(function(e){return d&&y[e.keyCode]?y[e.keyCode](e):void 0}),s.on("click","img",function(e){e.stopImmediatePropagation(),$(this).parent().toggleClass("zoom")}),$overlay.on("click","aside",function(e){e.stopImmediatePropagation()}),$overlay.click(n),n(),s.scroll(r),$(window).resize(r),this.update=function(e){o=e,this.clear(),e[1].map(a).forEach(function(e){s.append(e)}),v.update(e),m.text(e[0])},this.show=function(e){e&&o!==e&&(i=0,this.update(e)),t(),r()},this.goTo=function(e){var t;if(0>e)t=0;else{if(e>h.length-1)return;t=s.scrollTop()+h[e].position().top}s.scrollTop(t)},this.previousPage=function(){this.goTo(i-1)},this.nextPage=function(){return i>h.length-1?!1:void this.goTo(i+1)},this.scrollBy=function(e){s.scrollTop(s.scrollTop()+e)},this.clear=function(){s.empty(),h=[]},this.getCurrentIndex=function(){return i}}var H=function(){function e(e,t){e=""+e;for(var n=e.length;t>n;n++)e="0"+e;return e}function t(e){return e=e.toLowerCase(),r.forEach(function(t){e=e.replace(t[0],t[1])}),e.replace(/[^a-z0-9]+/g,"-")}function n(e,t){return t?"images/thumbs/"+e+".jpg":"images/reader/"+e+".jpg"}var r=[[/ä/g,"ae"],[/ö/g,"oe"],[/ü/g,"ue"],[/ß/g,"ss"],[/é/g,"e"]],a=!!navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone/i),o=window!==window.top;return{zerofill:e,imgSrc:n,filename:t,mobile:a,framed:o}}(),raubkunst,debug;$(function(){function e(){}function t(e){Title.set(e[0]),r.blur(),r.val(e[0]),o.update(e),search.clean(e[0]),artistDownloadButton(e),window.history.pushState&&window.history.pushState(e[0],e[0],"?q="+e[0])}function n(e,n){var r=search.query(e);return r.length>1?(t(r),!0):(n&&n(),!1)}var r,a=new Reader(".reader"),o=new PageNav("#read nav",{reader:a}),i=($(document.body),$("#form form"));new FastClick(document.body);var s=function(){var e=window.location.search.match(/(?:\?|&)q=([^&#]*)/);return null===e?null:decodeURIComponent(e[1])}();s&&$("#search-query").val(s),$.getJSON("data/raubkunst.json",function(t){raubkunst={artists:t[0],merchants:t[1]},r=search.init(),r.on("keyup mouseup",function(e){return 13===e.keyCode?(e.preventDefault(),void i.submit()):void window.setTimeout(function(){search.dirty(r.val())},1)}),r.on("typeahead:cursorchanged typeahead:autocompleted",function(t,n){e(n)}),$(search).on("search:dirty",function(){artistDownloadButton()}),window.addEventListener("popstate",function(e){$("#search-query").val(e.state),n(e.state)}),s&&n(s)}),artistDownloadButton=function(){var e=$("#artist-download"),t=e.find(".step1"),n=e.find(".js-filesize"),r=t.text();return function(a){if(!a)return t.text(r),e.attr("href"),e.addClass("disabled"),!1;var o=a[0],i=a[1].length,s=H.filename(o);e.removeClass("disabled"),t.text("en"===lang?"Download All Pages about "+o:"Alle Seiten zu "+o+" herunterladen"),e.attr("href","pdf/"+s+".pdf"),n.text("ca. "+Math.ceil(.11*(i+1))+" MB")}}(),i.submit(function(e){if(H.framed)return!0;e.preventDefault();var t=r.val();n(t)})}),$(function(){$(".toggler").each(function(){var e=$(this),t=$(e.attr("href"));t.addClass("hidden"),e.click(function(e){e.preventDefault(),t.toggleClass("hidden"),$(window).scrollTop(t.position().top)})})});var search=function(){function e(e,t){var n;if("*"===e){n=[];for(var r in raubkunst)raubkunst[r].forEach(function(e){n.push(e)})}else n=raubkunst[e];var a=new Fuse(n,{keys:[0],threshold:.3,shouldSort:!1,includeScore:!0});return function(e,n){var r=a.search(e);return r.sort(function(e,t){return 0===t.score&&0!==e.score?1:0===e.score&&0!==t.score?-1:(1-t.score)*t.item[1].length-(1-e.score)*e.item[1].length}),r=r.map(function(e){return e.item}).slice(0,10),t?void n(r):r}}function t(t){return{name:t,source:e(t,!0),displayKey:function(e){return e[0]},templates:{header:"<h3>"+a[t]+"</h3>",empty:"en"===lang?'<p class="empty">No results</p>':'<p class="empty">Keine Ergebnisse</p>',suggestion:function(e){return'<p class="needsclick">'+e[0]+"</p>"}}}}function n(){var n=$("#search-query").typeahead({minLength:1,highlight:!0},t("artists"),t("merchants"));return c=e("*",!1),i=$("#search-form"),s=$("#tf-query"),n.on("typeahead:selected",function(){i.submit()}),H.framed||n.focus(),H.framed&&n.on("touchend",function(){var e=$(this);0===e.val().length&&e.val(" ")}),$(document).keydown(function(e){var t=e.keyCode;if(!n.is(":focus"))if(t>=65&&90>=t){n.focus();var r=n.val().length;n[0].setSelectionRange(r,r),u(n.val())}else if(8===t){n.focus();var r=n.val().length;n[0].setSelectionRange(r,r),d()&&n.val(""),u(n.val())}}),n}function r(e){return c(e)[0]}var a,o={};a="en"===lang?{artists:"Artists",merchants:"Merchants"}:{artists:"Künstler·innen",merchants:"Händler·innen"};var i,s,c,l,u,d,h;return function(){var e,t=!0,n=$(document.body);l=function(r){r&&(e=r),t=!0,n.addClass("clean").removeClass("dirty"),$(o).trigger("search:clean")},u=function(r){r!==e?t&&(t=!1,n.removeClass("clean").addClass("dirty"),$(o).trigger("search:dirty")):l(r)},d=function(){return t},h=function(){return!t}}(),o.init=n,o.query=r,o.clean=l,o.dirty=u,o.isClean=d,o.isDirty=h,o}(),Title=function(){var e=document.title;return{set:function(t){document.title=t&&""!==t?t+": "+e:e}}}();$(function(){function e(){n=$(window).width(),550>n&&0!==t.state?(t.state=0,t.$el.attr("placeholder",t.$el.attr("data-placeholder-short"))):n>=550&&1!==t.state&&(t.state=1,t.$el.attr("placeholder",t.original))}var t={$el:$("#search-query"),state:1};t.original=t.$el.attr("placeholder");var n;e(),$(window).resize(e)});